{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{ restaurante.nombre }} | TopMeal</title>
    <link rel="stylesheet" href="{% static 'css/base/restaurante_detail.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="{% static 'img/base/logo.png' %}" type="image/x-icon">
    <style>
        body {
            min-height: 100vh;
            margin: 0;
            font-family: 'Montserrat', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f5e8d3 0%, #fff 100%);
            color: #222;
            overflow-x: hidden;
        }
        .hero-section {
            width: 100vw;
            min-height: 340px;
            background: linear-gradient(120deg, #e63946 60%, #e9c46a 100%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px #e6394615, 0 2px 8px #e6394622;
        }
        .hero-bg-img {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1500&q=80') center/cover no-repeat;
            opacity: 0.13;
            z-index: 0;
        }
        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 48px;
            padding: 64px 32px 48px 32px;
        }
        .hero-info {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .hero-info h1 {
            font-size: 3em;
            font-weight: 900;
            margin: 0 0 10px 0;
            letter-spacing: 2px;
            text-shadow: 0 2px 12px #0005;
        }
        .hero-info .details {
            font-size: 1.2em;
            margin-bottom: 18px;
            color: #fffbe6;
        }
        .hero-info .rating {
            font-size: 1.5em;
            font-weight: 700;
            color: #e9c46a;
            margin-bottom: 8px;
        }
        .hero-info .actions {
            margin-top: 18px;
        }
        .hero-info .btn-rate {
            background: linear-gradient(90deg, #e9c46a 60%, #fff 100%);
            color: #e63946;
            border: none;
            border-radius: 18px;
            padding: 12px 38px;
            font-size: 1.15em;
            font-weight: 700;
            box-shadow: 0 2px 8px #e6394610;
            letter-spacing: 1px;
            cursor: pointer;
            transition: background 0.18s, color 0.18s;
        }
        .hero-info .btn-rate:hover {
            background: #fff;
            color: #e63946;
        }
        .hero-img {
            flex: 1.2;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hero-img img {
            width: 320px;
            height: 320px;
            object-fit: cover;
            border-radius: 50%;
            border: 7px solid #fffbe6;
            box-shadow: 0 8px 32px #e6394620, 0 2px 8px #2222;
            background: #fff;
        }
        .main-layout {
            max-width: 1300px;
            margin: -80px auto 0 auto;
            display: grid;
            grid-template-columns: 2fr 1.1fr;
            gap: 40px;
            position: relative;
            z-index: 2;
        }
        .main-left {
            display: flex;
            flex-direction: column;
            gap: 36px;
        }
        .main-right {
            display: flex;
            flex-direction: column;
            gap: 36px;
        }
        .card {
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 8px 32px #e6394610, 0 2px 8px #e9c46a22;
            padding: 38px 32px 32px 32px;
            margin-bottom: 0;
            position: relative;
            overflow: hidden;
        }
        .card h2 {
            color: #e63946;
            font-size: 2em;
            font-weight: 900;
            letter-spacing: 1px;
            text-align: left;
            margin-bottom: 18px;
            text-shadow: 0 2px 12px #e6394622;
        }
        .menu-img-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
        }
        .menu-img-container img {
            width: 100%;
            max-width: 420px;
            border-radius: 18px;
            border: 3px solid #e9c46a;
            box-shadow: 0 8px 32px #e6394610, 0 2px 8px #e9c46a22;
            background: #fffbe6;
            transition: transform 0.18s, box-shadow 0.18s;
            cursor: pointer;
        }
        .menu-img-container img:hover {
            transform: scale(1.04);
            box-shadow: 0 16px 40px #e6394630, 0 2px 8px #e9c46a22;
        }
        .menu-img-container .btn-delivery {
            margin-top: 6px;
            font-size: 1.1em;
            font-weight: 700;
            letter-spacing: 1px;
            padding: 12px 32px;
            border-radius: 12px;
            background: linear-gradient(90deg,#e63946 70%,#e9c46a 100%);
            color: #fff;
            box-shadow: 0 2px 8px #e6394610;
            transition: background 0.18s, transform 0.18s;
            cursor: pointer;
            display: inline-block;
            border: none;
        }
        .menu-img-container .btn-delivery:hover {
            background: linear-gradient(90deg,#b92d3a 70%,#e9c46a 100%);
            transform: scale(1.04);
        }
        .reservation-card {
            min-height: 480px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom:18px;
        }
        .calendar-title {
            font-weight:900; min-width:140px; text-align:center; color:#e63946; font-size:1.15em; letter-spacing:1px;
        }
        .calendar {
            background:#fffbe6;
            border-radius:14px;
            padding:12px 0 8px 0;
            box-shadow:0 2px 8px #e9c46a22;
            margin-bottom:18px;
        }
        .reservation-card label {
            font-weight:700;
            color:#e63946;
            letter-spacing:1px;
        }
        .reservation-card select {
            width:100%;
            padding:12px 10px;
            margin-bottom:10px;
            border-radius:8px;
            border:1.5px solid #e9c46a;
            font-size:1.1em;
            background:#fffbe6;
            outline:none;
            box-shadow:0 1px 4px #e9c46a22;
            cursor:pointer;
        }
        .reservation-card .btn-primary {
            width:100%;
            margin-top:18px;
            font-size:1.18em;
            font-weight:800;
            letter-spacing:1px;
            padding:14px 0;
            box-shadow:0 2px 8px #e6394610;
            background:linear-gradient(90deg,#e63946 70%,#e9c46a 100%);
            border-radius:12px;
            transition:background 0.18s,transform 0.18s;
            cursor:pointer;
            border: none;
            color: #fff;
        }
        .reservation-card .btn-primary:hover {
            background:linear-gradient(90deg,#b92d3a 70%,#e9c46a 100%);
        }
        .opinions-card {
            margin-top: 0;
        }
        .opinions-list {
            display: flex;
            flex-direction: column;
            gap: 22px;
            margin-top: 18px;
        }
        .opinion-item {
            background: linear-gradient(120deg, #fff 80%, #e9c46a22 100%);
            border-radius: 18px;
            box-shadow: 0 8px 24px #e6394610, 0 2px 8px #2222;
            padding: 18px 14px 14px 14px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            border: 2px solid #e9c46a;
            transition: box-shadow 0.18s, transform 0.18s;
            position: relative;
        }
        .opinion-item .opinion-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .opinion-item .opinion-user {
            font-weight:700;
            color:#e63946;
            font-size:1.08em;
        }
        .opinion-item .opinion-comment {
            color: #444;
            font-size: 1em;
            margin-bottom: 10px;
            font-style: italic;
            text-align: left;
            line-height:1.5;
        }
        .opinion-item .opinion-rating {
            font-size: 1em;
            font-weight: 700;
            color: #fff;
            background: linear-gradient(90deg, #e63946 60%, #e9c46a 100%);
            border-radius: 8px;
            padding: 4px 14px;
            margin-bottom: 0;
            margin-top: 6px;
            display: inline-block;
            box-shadow: 0 2px 8px #e6394610;
            letter-spacing: 1px;
        }
        /* ----------- RESPONSIVE ----------- */
        @media (max-width: 1200px) {
            .main-layout { grid-template-columns: 1fr; gap: 32px; }
            .main-left, .main-right { width: 100%; }
        }
        @media (max-width: 900px) {
            .hero-content { flex-direction: column; gap: 24px; padding: 32px 8px 24px 8px; }
            .main-layout { padding: 0 8px; }
            .main-left, .main-right { margin-top: 0 !important; }
            .card { padding: 28px 12px 18px 12px; }
        }
        @media (max-width: 700px) {
            .hero-section { min-height: 180px; }
            .hero-content { flex-direction: column; gap: 10px; padding: 12px 2vw 12px 2vw; }
            .hero-img img { width: 120px; height: 120px; }
            .main-layout { gap: 10px; padding: 0 2vw; }
            .main-left, .main-right { margin-top: 0 !important; }
            .card { padding: 12px 4px 10px 4px; }
            .card h2 { font-size: 1.2em; margin-bottom: 10px; }
            .menu-img-container img { max-width: 98vw; }
            .opinions-list { gap: 12px; }
            .opinion-item { padding: 10px 6px 8px 6px; }
        }
        @media (max-width: 500px) {
            .hero-content { padding: 6px 2vw 6px 2vw; }
            .hero-info h1 { font-size: 1.5em; }
            .hero-info .details { font-size: 1em; }
            .hero-info .rating { font-size: 1.1em; }
            .main-layout { gap: 6px; }
            .card { padding: 6px 2px 6px 2px; }
            .opinions-card, .reservation-card { padding: 6px 2px 6px 2px; }
            .menu-img-container img { max-width: 96vw; }
        }
    </style>
</head>
<body>
    <!-- Sticky Navbar -->
    <nav class="navbar">
        <div class="navbar-logo">
            <img src="{% static 'img/base/logo.png' %}" alt="TopMeal Logo">
            <a href="{% url 'inicio' %}">
                <span>TopMeal</span>
            </a>
        </div>
        <div class="navbar-actions">
            {% if usuario_nombre %}
                <div style="display:flex;align-items:center;gap:14px;">
                    <span style="font-weight:600;padding:7px 18px;background:#f5e8d3;color:#e63946;border-radius:20px;font-size:1em;box-shadow:0 1px 6px #0001;display:flex;align-items:center;">
                        <span style="vertical-align:middle;">{{ usuario_nombre }}</span>
                    </span>
                    <a href="{% url 'logout' %}" class="btn-outline" style="background:#e63946;color:#fff;border:none;">Cerrar sesión</a>
                </div>
            {% else %}
                <a href="{% url 'register' %}" class="btn-outline">Registrarse</a>
                <a href="{% url 'login' %}" class="btn-primary">Iniciar Sesión</a>
            {% endif %}
        </div>
    </nav>
    <!-- Hero Section -->
    <header class="hero-section">
        <div class="hero-bg-img"></div>
        <div class="hero-content">
            <div class="hero-info">
                <h1>{{ restaurante.nombre }}</h1>
                <div class="details">
                    <div><b>Dirección:</b> {{ restaurante.direccion }}</div>
                    <div><b>Tipo:</b> {{ restaurante.tipo }}{% if restaurante.precio_medio %} | <b>Precio medio:</b> {{ restaurante.precio_medio }} €{% endif %}</div>
                </div>
                <div class="rating">
                    {{ restaurante.media_valoracion|default:"-" }} / 5
                    {% if restaurante.num_opiniones %}
                        <span style="font-size:0.7em;color:#fffbe6;">({{ restaurante.num_opiniones }} opiniones)</span>
                    {% endif %}
                </div>
                <div class="actions">
                    <button class="btn-rate">Valorar restaurante</button>
                </div>
            </div>
            <div class="hero-img">
                <img src="{{ restaurante.imagen_url }}" alt="Imagen principal de {{ restaurante.nombre }}">
            </div>
        </div>
    </header>
    <main>
        <div class="main-layout" style="margin-top: 40px;">
            <div class="main-left" style="margin-top: 18px;">
                <!-- Menu Card -->
                <div class="card">
                    <h2>Carta</h2>
                    <div class="menu-img-container">
                        <img id="menu-img" src="{{ menu.imagen_url }}" alt="Menú del restaurante" title="Haz clic para ver en grande">
                        <a href="{% url 'pedido_domicilio' restaurante.id %}" class="btn-delivery" style="text-align:center;display:inline-block;">Pedir a domicilio</a>
                    </div>
                </div>
            </div>
            <div class="main-right" style="margin-top: 18px;">
                <!-- Reservation Card -->
                <div class="card reservation-card">
                    <h2>Reservar mesa</h2>
                    <div class="calendar-header">
                        <button class="prev-month" aria-label="Mes anterior" id="prevMonthBtn"
                            style="background: #e63946; color: #fff; border: none; border-radius: 50%; width: 38px; height: 38px; font-size: 1.3em; box-shadow: 0 2px 8px #e6394610; cursor: pointer; display: flex; align-items: center; justify-content: center; outline: none; transition: background 0.2s, transform 0.18s;"
                            onmouseover="this.style.background='#b92d3a';this.style.transform='scale(1.08)';"
                            onmouseout="this.style.background='#e63946';this.style.transform='scale(1)';"
                        >&#9664;</button>
                        <span class="calendar-title" id="calendarTitle"></span>
                        <button class="next-month" aria-label="Mes siguiente" id="nextMonthBtn"
                            style="background: #e63946; color: #fff; border: none; border-radius: 50%; width: 38px; height: 38px; font-size: 1.3em; box-shadow: 0 2px 8px #e6394610; cursor: pointer; display: flex; align-items: center; justify-content: center; outline: none; transition: background 0.2s, transform 0.18s;"
                            onmouseover="this.style.background='#b92d3a';this.style.transform='scale(1.08)';"
                            onmouseout="this.style.background='#e63946';this.style.transform='scale(1)';"
                        >&#9654;</button>
                    </div>
                    <div class="calendar" id="calendarDays">
                        <!-- Los días se generan por JS -->
                    </div>
                    <div style="display:flex;gap:18px;flex-wrap:wrap;justify-content:center;">
                        <div style="flex:1;min-width:120px;max-width:180px;">
                            <label for="horaReserva">Hora</label>
                            <select id="horaReserva">
                                <option value="13:00">13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                                <option value="14:30">14:30</option>
                                <option value="15:00">15:00</option>
                                <option value="21:00">21:00</option>
                                <option value="21:30">21:30</option>
                                <option value="22:00">22:00</option>
                            </select>
                        </div>
                        <div style="flex:1;min-width:120px;max-width:180px;">
                            <label for="personasReserva">Personas</label>
                            <select id="personasReserva">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-primary" id="btnReservar" aria-label="Confirmar reserva">
                        Reservar ahora
                    </button>
                    <div id="reserva-msg" style="display:none; margin-top:14px; font-size:1.1em; font-weight:700; text-align:center;"></div>
                </div>
            </div>
        </div>
        <!-- Opiniones Card ocupa todo el ancho debajo de main-layout -->
        <div style="max-width:1300px;margin:40px auto 0 auto;">
            <div class="card opinions-card" style="width:100%;box-sizing:border-box;">
                <h2>Opiniones</h2>
                <div style="font-size:1.2em;font-weight:700;color:#e63946;margin-bottom:10px;">
                    {{ restaurante.media_valoracion|default:"-" }} / 5
                    <span style="color:#888;font-size:0.9em;font-weight:400;margin-left:8px;">({{ num_opiniones_real }} opiniones)</span>
                </div>
                <div class="opinions-list">
                    {% for opinion in ultimas_opiniones %}
                    <div class="opinion-item">
                        <div class="opinion-header">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="#e63946" viewBox="0 0 24 24" style="vertical-align:middle;">
                                <circle cx="12" cy="12" r="10" fill="#e63946" opacity="0.12"/>
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="#e63946"/>
                            </svg>
                            <span class="opinion-user">{{ opinion.usuario }}</span>
                        </div>
                        <div class="opinion-comment">"{{ opinion.comentario }}"</div>
                        <span class="opinion-rating">{{ opinion.puntuacion }}/5</span>
                    </div>
                    {% empty %}
                    <p style="margin-top:12px;">Este restaurante aún no tiene opiniones.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>
    <!-- Footer -->
    <footer class="footer" id="contacto" style="background: #222; color: #fff; padding: 36px 0 0 0; margin-top: 0;">
        <div class="footer-main" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; max-width: 1100px; margin: 0 auto; padding: 0 24px; gap: 32px;">
            <div class="footer-logo" style="display: flex; align-items: center; gap: 10px; font-size: 1.3em; font-weight: bold; color: #e63946;">
                <img src="{% static 'img/base/logo.png' %}" alt="TopMeal Logo" style="height: 34px;">
                <span>TopMeal</span>
            </div>
            <div class="footer-links" style="display: flex; gap: 38px;">
                <div style="display: flex; flex-direction: column; gap: 6px;">
                    <h5 style="color: #e9c46a; font-size: 1.05em; margin-bottom: 4px;">Colabora</h5>
                    <a href="#" style="color: #fff; font-size: 0.98em; opacity: 0.85; transition: opacity 0.18s;">Repartidores</a>
                    <a href="#" style="color: #fff; font-size: 0.98em; opacity: 0.85; transition: opacity 0.18s;">Trabaja con nosotros</a>
                    <a href="#" style="color: #fff; font-size: 0.98em; opacity: 0.85; transition: opacity 0.18s;">Añade tu restaurante</a>
                </div>
                <div style="display: flex; flex-direction: column; gap: 6px;">
                    <h5 style="color: #e9c46a; font-size: 1.05em; margin-bottom: 4px;">Enlaces</h5>
                    <a href="{% url 'acerca' %}" style="color: #fff; font-size: 0.98em; opacity: 0.85; transition: opacity 0.18s;">Acerca de nosotros</a>
                    <a href="{% url 'contacto' %}" style="color: #fff; font-size: 0.98em; opacity: 0.85; transition: opacity 0.18s;">Contacto</a>
                    <!-- <a href="#">Seguridad</a> -->
                </div> 
                <div style="display: flex; flex-direction: column; gap: 6px;">
                    <h5 style="color: #e9c46a; font-size: 1.05em; margin-bottom: 4px;">Legal</h5>
                    <a href="{% url 'legales' %}" style="color: #fff; font-size: 0.98em; opacity: 0.85; transition: opacity 0.18s;">Cookies</a>
                    <a href="{% url 'legales' %}" style="color: #fff; font-size: 0.98em; opacity: 0.85; transition: opacity 0.18s;">Condiciones de uso</a>
                    <a href="{% url 'legales' %}" style="color: #fff; font-size: 0.98em; opacity: 0.85; transition: opacity 0.18s;">Privacidad</a>
                </div>
            </div>
            <div class="footer-social" style="background: #222; border-radius: 12px; padding: 18px 0; display: flex; justify-content: center; gap: 18px;">
                <a href="#"><img src="https://img.icons8.com/color/48/000000/facebook-new.png" alt="Facebook" style="width: 32px; height: 32px; object-fit: contain; border-radius: 8px; background: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.07);"></a>
                <a href="#"><img src="https://img.icons8.com/color/48/000000/instagram-new.png" alt="Instagram" style="width: 32px; height: 32px; object-fit: contain; border-radius: 8px; background: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.07);"></a>
                <a href="#"><img src="https://img.icons8.com/color/48/000000/twitterx--v2.png" alt="X" style="width: 32px; height: 32px; object-fit: contain; border-radius: 8px; background: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.07);"></a>
            </div>
        </div>
        <div class="footer-copy" style="text-align: center; color: #bbb; font-size: 0.98em; margin-top: 18px; padding-bottom: 18px;">
            &copy; 2025 TopMeal. Todos los derechos reservados.
        </div>
    </footer>
    <!-- Modal para carta en grande -->
    <div id="menu-modal" style="display:none;position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(34,34,59,0.92);align-items:center;justify-content:center;">
        <span id="close-menu-modal" style="position:absolute;top:32px;right:48px;font-size:3em;color:#fff;cursor:pointer;z-index:10001;font-weight:bold;user-select:none;">&times;</span>
        <img id="menu-modal-img" src="" alt="Carta en grande" style="max-width:90vw;max-height:90vh;border-radius:18px;box-shadow:0 8px 32px #000c;">
    </div>
    <script>
        // Calendario interactivo
        document.addEventListener('DOMContentLoaded', function() {
            const calendarTitle = document.getElementById('calendarTitle');
            const calendarDays = document.getElementById('calendarDays');
            const nextMonthBtn = document.getElementById('nextMonthBtn');
            const prevMonthBtn = document.getElementById('prevMonthBtn');
            window.selectedDate = null;

            let today = new Date();
            let currentMonth = today.getMonth();
            let currentYear = today.getFullYear();

            function renderCalendar(month, year) {
                calendarDays.innerHTML = '';
                const daysOfWeek = ['lun', 'mar', 'mié', 'jue', 'vie', 'sáb', 'dom'];
                daysOfWeek.forEach(d => {
                    const span = document.createElement('span');
                    span.className = 'day-header';
                    span.textContent = d;
                    calendarDays.appendChild(span);
                });
                const firstDay = new Date(year, month, 1);
                let startDay = firstDay.getDay();
                startDay = startDay === 0 ? 7 : startDay;
                for (let i = 1; i < startDay; i++) {
                    calendarDays.appendChild(document.createElement('span'));
                }
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                for (let d = 1; d <= daysInMonth; d++) {
                    const dateObj = new Date(year, month, d);
                    const span = document.createElement('span');
                    span.className = 'day';
                    span.textContent = d;
                    if (
                        (year < today.getFullYear()) ||
                        (year === today.getFullYear() && month < today.getMonth()) ||
                        (year === today.getFullYear() && month === today.getMonth() && d < today.getDate())
                    ) {
                        span.classList.add('disabled');
                    } else {
                        span.addEventListener('click', function() {
                            calendarDays.querySelectorAll('.day.selected').forEach(el => el.classList.remove('selected'));
                            span.classList.add('selected');
                            window.selectedDate = new Date(year, month, d);
                        });
                    }
                    calendarDays.appendChild(span);
                }
            }

            function updateCalendarTitle(month, year) {
                const meses = [
                    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
                ];
                calendarTitle.innerHTML = `<b>${meses[month]} de ${year}</b>`;
            }

            updateCalendarTitle(currentMonth, currentYear);
            renderCalendar(currentMonth, currentYear);

            nextMonthBtn.addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                updateCalendarTitle(currentMonth, currentYear);
                renderCalendar(currentMonth, currentYear);
            });

            prevMonthBtn.addEventListener('click', function() {
                if (currentYear > today.getFullYear() || (currentYear === today.getFullYear() && currentMonth > today.getMonth())) {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    updateCalendarTitle(currentMonth, currentYear);
                    renderCalendar(currentMonth, currentYear);
                }
            });

            function getFechaSeleccionada() {
                if (!selectedDate) return null;
                const y = selectedDate.getFullYear();
                const m = String(selectedDate.getMonth() + 1).padStart(2, '0');
                const d = String(selectedDate.getDate()).padStart(2, '0');
                return `${y}-${m}-${d}`;
            }

            document.getElementById('btnReservar').addEventListener('click', function() {
                const fecha = getFechaSeleccionada();
                if (!fecha) {
                    if (document.getElementById('reserva-msg')) {
                        document.getElementById('reserva-msg').style.display = 'block';
                        document.getElementById('reserva-msg').style.color = 'red';
                        document.getElementById('reserva-msg').textContent = 'Selecciona una fecha válida para la reserva.';
                    }
                    return;
                }
                const hora = document.getElementById('horaReserva').value;
                const personas = document.getElementById('personasReserva').value;
                fetch("{% url 'api_reservar' restaurante.id %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": "{{ csrf_token }}"
                    },
                    body: JSON.stringify({
                        fecha: fecha,
                        hora: hora,
                        numero_personas: personas
                    })
                })
                .then(resp => resp.json())
                .then(data => {
                    if (data.success) {
                        if (document.getElementById('reserva-msg')) {
                            document.getElementById('reserva-msg').style.display = 'block';
                            document.getElementById('reserva-msg').style.color = 'green';
                            document.getElementById('reserva-msg').textContent = '¡Reserva realizada correctamente!';
                        }
                    } else {
                        if (document.getElementById('reserva-msg')) {
                            document.getElementById('reserva-msg').style.display = 'block';
                            document.getElementById('reserva-msg').style.color = 'red';
                            document.getElementById('reserva-msg').textContent = data.error || 'Error al reservar';
                        }
                    }
                });
            });
        });

        // Modal para carta
        document.addEventListener('DOMContentLoaded', function() {
            var menuImg = document.getElementById('menu-img');
            var menuModal = document.getElementById('menu-modal');
            var menuModalImg = document.getElementById('menu-modal-img');
            var closeMenuModal = document.getElementById('close-menu-modal');
            if (menuImg && menuModal && menuModalImg && closeMenuModal) {
                menuImg.addEventListener('click', function() {
                    menuModal.style.display = 'flex';
                    menuModalImg.src = menuImg.src;
                    document.body.style.overflow = 'hidden';
                });
                closeMenuModal.addEventListener('click', function() {
                    menuModal.style.display = 'none';
                    document.body.style.overflow = '';
                });
                menuModal.addEventListener('click', function(e) {
                    if (e.target === menuModal) {
                        menuModal.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && menuModal.style.display === 'flex') {
                        menuModal.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
            }
        });
    </script>
</body>
</html>
